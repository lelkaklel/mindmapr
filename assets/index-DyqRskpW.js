import{r as A,a as lt,R as dt}from"./react-DJ1oPbzn.js";import{s as _,z as ht,i as Q,h as ut,t as W,a as T}from"./d3-CSd-2QcB.js";import{h as U,F as nt,E as ft}from"./vendor-B5CLxLTD.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))p(u);new MutationObserver(u=>{for(const i of u)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function $(u){const i={};return u.integrity&&(i.integrity=u.integrity),u.referrerPolicy&&(i.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?i.credentials="include":u.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function p(u){if(u.ep)return;u.ep=!0;const i=$(u);fetch(u.href,i)}})();var it={exports:{}},H={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pt=A,gt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),xt=Object.prototype.hasOwnProperty,yt=pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wt={key:!0,ref:!0,__self:!0,__source:!0};function ct(R,m,$){var p,u={},i=null,f=null;$!==void 0&&(i=""+$),m.key!==void 0&&(i=""+m.key),m.ref!==void 0&&(f=m.ref);for(p in m)xt.call(m,p)&&!wt.hasOwnProperty(p)&&(u[p]=m[p]);if(R&&R.defaultProps)for(p in m=R.defaultProps,m)u[p]===void 0&&(u[p]=m[p]);return{$$typeof:gt,type:R,key:i,ref:f,props:u,_owner:yt.current}}H.Fragment=mt;H.jsx=ct;H.jsxs=ct;it.exports=H;var a=it.exports,tt={},rt=lt;tt.createRoot=rt.createRoot,tt.hydrateRoot=rt.hydrateRoot;const F=200,ot=80,st={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},Ct=({data:R,onNodeClick:m,onNodeUpdate:$,onNodeDelete:p,exportRef:u})=>{const i=A.useRef(null),f=A.useRef(null),[x,M]=A.useState(null),[et,X]=A.useState(1),[O,J]=A.useState({width:0,height:0}),z=()=>{if(f.current){const{width:n,height:w}=f.current.getBoundingClientRect();J({width:n,height:w})}},V=async()=>{if(!(!i.current||!f.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=_(i.current),w=n.select("g"),E=W(n.node()),b=f.current.getBoundingClientRect(),o=b.width,s=b.height,c=document.createElement("div");document.body.appendChild(c),c.style.position="absolute",c.style.left="-9999px",c.style.width="1200px",c.style.height="842px";const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width","1200"),l.setAttribute("height","842"),l.setAttribute("viewBox","0 0 1200 842");const N=document.createElementNS("http://www.w3.org/2000/svg","g"),g=w.node();if(g){Array.from(g.childNodes).forEach(K=>{N.appendChild(K.cloneNode(!0))});const r=40,t=g.getBBox(),e=(1200-r*2)/t.width,d=(842-r*2)/t.height,h=Math.min(e,d,2),P=1200/2,k=842/2,D=`translate(${P}, ${k}) scale(${h}) translate(${-t.x-t.width/2}, ${-t.y-t.height/2})`;N.setAttribute("transform",D),l.appendChild(N),c.appendChild(l)}const y=await U(c,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(c);const B=new ft({orientation:"landscape",unit:"mm",format:"a4"}),L=y.toDataURL("image/jpeg",1);B.addImage(L,"JPEG",0,0,297,210),B.save("mind_map.pdf")}catch(n){console.error("Ошибка при экспорте в PDF:",n)}}},Z=async()=>{if(!(!i.current||!f.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=_(i.current),w=n.select("g"),E=W(n.node()),b=f.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=w.node();if(l){Array.from(l.childNodes).forEach(h=>{c.appendChild(h.cloneNode(!0))});const g=50,y=l.getBBox(),B=(1500-g*2)/y.width,L=(1e3-g*2)/y.height,r=Math.min(B,L,2),t=1500/2,e=1e3/2,d=`translate(${t}, ${e}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;c.setAttribute("transform",d),s.appendChild(c),o.appendChild(s)}const N=await U(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),N.toBlob(g=>{g&&nt.saveAs(g,"mind_map.png")},"image/png")}catch(n){console.error("Ошибка при экспорте в PNG:",n)}}},q=async()=>{if(!(!i.current||!f.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=_(i.current),w=n.select("g"),E=W(n.node()),b=f.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=w.node();if(l){Array.from(l.childNodes).forEach(h=>{c.appendChild(h.cloneNode(!0))});const g=50,y=l.getBBox(),B=(1500-g*2)/y.width,L=(1e3-g*2)/y.height,r=Math.min(B,L,2),t=1500/2,e=1e3/2,d=`translate(${t}, ${e}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;c.setAttribute("transform",d),s.appendChild(c),o.appendChild(s)}const N=await U(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),N.toBlob(g=>{g&&nt.saveAs(g,"mind_map.jpg")},"image/jpeg",.9)}catch(n){console.error("Ошибка при экспорте в JPEG:",n)}}};A.useEffect(()=>{u&&(u.current={exportAsPDF:V,exportAsPNG:Z,exportAsJPEG:q})},[u]),A.useEffect(()=>(z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)),[]);const C=(n,w,E)=>{const b=w/2,o=E/2,s=l=>!l.children||l.children.length===0?ot:Math.max(ot,T(l.children,N=>s(N))),c=(l,N,g,y=!1,B=E,L=o,r=0)=>{if(l.y=N,l.x=g,!l.children||l.children.length===0)return;const t=[...l.children].sort((h,P)=>{const k=s(h);return s(P)-k}),e=T(t,h=>s(h));let d=g-e/2;t.forEach(h=>{const P=s(h),k=d+P/2,D=y?N-F:N+F;c(h,D,k,y,P,g,r+1),d+=P})};if(n.x=o,n.y=b,n.children&&n.children.length>0){const l=Math.ceil(n.children.length/2);n.children.length-l;const N=n.children.slice(0,l),g=n.children.slice(l),y=T(N,t=>s(t)),B=T(g,t=>s(t));let L=o-y/2;N.forEach(t=>{const e=s(t),d=L+e/2;c(t,b-F,d,!0,e,o,1),L+=e});let r=o-B/2;g.forEach(t=>{const e=s(t),d=r+e/2;c(t,b+F,d,!1,e,o,1),r+=e})}return n},S=(n,w=14)=>n.length*w*.6+10,v=n=>st[n.toString()]||st.default,j=()=>{if(!x)return;const n={id:Date.now().toString(),text:"Новый узел",children:[]};x.node.children.push(n),$&&$(x.node),M(null)},Y=()=>{!x||x.depth===0||!x.parentId||p&&(p(x.node.id,x.parentId),M(null))},G=()=>{if(!x||!$)return;const n={...x.node,text:x.text};$(n),M(null)};A.useEffect(()=>{if(!i.current||!R||O.width===0)return;const n=O.width,w=O.height;_(i.current).selectAll("*").remove();const E=_(i.current).attr("width",n).attr("height",w),b=E.append("g"),o=ht().scaleExtent([.1,3]).on("zoom",r=>{b.attr("transform",r.transform),X(r.transform.k)});E.call(o);const s=E.append("g").attr("class","zoom-controls").attr("transform",`translate(${n-35}, 20)`);s.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{E.transition().duration(300).call(o.scaleBy,1.2)}),s.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),s.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{E.transition().duration(300).call(o.scaleBy,.8)}),s.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),s.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const r=b.node();if(r){const t=r.getBBox(),e=40,d=(n-e*2)/t.width,h=(w-e*2)/t.height,P=Math.min(d,h,.8),k=n/2,D=w/2,K=Q.translate(k,D).scale(P).translate(-t.x-t.width/2,-t.y-t.height/2);E.transition().duration(500).call(o.transform,K)}}),s.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const c=ut(R.root);C(c,n,w);const l=b.append("g").attr("class","links-layer"),N=b.append("g").attr("class","nodes-layer"),g=(r,t)=>{const e=t?r.source:r.target,d=v(e.depth),h=e.y<n/2,k=(S(e.data.text,d.fontSize)+d.padding*2)/2;return d.height/2,t?r.target.y<e.y?{x:e.y-k,y:e.x}:{x:e.y+k,y:e.x}:h?{x:e.y+k,y:e.x}:{x:e.y-k,y:e.x}},y=r=>{const t=g(r,!0),e=g(r,!1);return`M${t.x},${t.y} Q${(t.x+e.x)/2},${t.y} ${(t.x+e.x)/2},${(t.y+e.y)/2} Q${(t.x+e.x)/2},${e.y} ${e.x},${e.y}`};l.selectAll(".link").data(c.links()).enter().append("path").attr("class","link").attr("d",y).style("fill","none").style("stroke",r=>r.target.depth===1?"#666":"#999").style("stroke-width",r=>{const t=r.target.depth;return Math.max(1,6-t*1.5)+"px"});const B=N.selectAll(".node").data(c.descendants()).enter().append("g").attr("class","node").attr("transform",r=>`translate(${r.y},${r.x})`);B.each(function(r){const t=_(this),e=v(r.depth);r.y<n/2;const d=S(r.data.text,e.fontSize)+e.padding*2,h=e.height;t.append("rect").attr("x",-d/2).attr("y",-h/2).attr("width",d).attr("height",h).attr("rx",5).attr("ry",5).style("fill",e.fill).style("stroke",e.stroke).style("stroke-width",e.strokeWidth),t.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${e.fontSize}px`).style("font-weight",e.fontWeight).style("fill",e.textColor).text(r.data.text)}),B.on("click",(r,t)=>{var k;r.stopPropagation(),(k=f.current)==null||k.getBoundingClientRect();const e=W(E.node()),d=t.y*e.k+e.x,h=t.x*e.k+e.y;let P;t.parent&&(P=t.parent.data.id),M({node:t.data,text:t.data.text,position:{x:d,y:h},parentId:P,depth:t.depth}),m&&m(t.data)}),E.on("click",()=>{M(null)}),B.append("g").attr("class","add-node-button").attr("transform",r=>{const t=r.y<n/2,e=v(r.depth),d=S(r.data.text,e.fontSize)+e.padding*2,h=Math.max(d/2+20,e.height+5);return`translate(${t?-h:h}, 0)`}).style("cursor","pointer").on("click",(r,t)=>{r.stopPropagation();const e={id:Date.now().toString(),text:"Новый узел",children:[]};t.data.children.push(e),$&&$(t.data)}).append("text").attr("dy",".35em").attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").style("fill","#4CAF50").text("+"),B.filter(r=>r.depth!==0).append("g").attr("class","delete-node-button").attr("transform",r=>{const t=r.y<n/2,e=v(r.depth),d=S(r.data.text,e.fontSize)+e.padding*2,h=Math.max(d/2+40,e.height+25);return`translate(${t?-h:h}, 0)`}).style("cursor","pointer").on("click",(r,t)=>{r.stopPropagation(),p&&t.parent&&p(t.data.id,t.parent.data.id)}).append("text").attr("dy",".35em").attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").style("fill","#f44336").text("×");const L=b.node();if(L){const r=L.getBBox(),t=40,e=(n-t*2)/r.width,d=(w-t*2)/r.height,h=Math.min(e,d,.8),P=n/2,k=w/2,D=Q.translate(P,k).scale(h).translate(-r.x-r.width/2,-r.y-r.height/2);E.call(o.transform,D)}else{const r=Q.translate(n/2,w/2).scale(.8);E.call(o.transform,r)}},[R,m,$,p,O]);const I=()=>{if(!x||!f.current)return{};const n=f.current.getBoundingClientRect(),w=x.position.x<O.width/2;v(x.depth);let E=w?-250:50,b=x.position.x+E;const o=250,s=120;b<0&&(b=10),b+o>n.width&&(b=n.width-o-10);let c=x.position.y-s/2;return c<0&&(c=10),c+s>n.height&&(c=n.height-s-10),{position:"absolute",left:`${b}px`,top:`${c}px`,zIndex:1e3}};return a.jsxs("div",{className:"mind-map-wrapper",ref:f,children:[a.jsx("svg",{ref:i}),x&&a.jsxs("div",{className:"edit-node-panel",style:I(),children:[a.jsx("input",{type:"text",value:x.text,onChange:n=>M({...x,text:n.target.value}),onKeyPress:n=>n.key==="Enter"&&G(),autoFocus:!0}),a.jsxs("div",{className:"edit-node-buttons buttons-row",children:[a.jsx("button",{onClick:G,className:"save-button",children:"Сохранить"}),a.jsx("button",{onClick:j,className:"add-button",children:"+"}),x.depth!==0&&a.jsx("button",{onClick:Y,className:"delete-button",children:"×"}),a.jsx("button",{onClick:()=>M(null),className:"cancel-button",children:"Отмена"})]})]})]})},at={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},bt=()=>{const[R,m]=A.useState(()=>{const C=localStorage.getItem("mindMapData");return C?JSON.parse(C):at}),[$,p]=A.useState(!1),u=A.useRef(null),i=A.useRef(null),f=A.useRef(null);A.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify(R))},[R]),A.useEffect(()=>{const C=S=>{u.current&&i.current&&!u.current.contains(S.target)&&!i.current.contains(S.target)&&p(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]);const x=C=>{console.log("Выбран узел:",C)},M=C=>{const S=v=>v.id===C.id?C:{...v,children:v.children.map(S)};m(v=>({root:S(v.root)}))},et=(C,S)=>{const v=j=>j.id===S?{...j,children:j.children.filter(Y=>Y.id!==C)}:{...j,children:j.children.map(v)};m(j=>({root:v(j.root)}))},X=()=>{const C={root:{id:R.root.id,text:at.root.text,children:[]}};m(C)},O=()=>{const C=JSON.stringify(R,null,2),S="data:application/json;charset=utf-8,"+encodeURIComponent(C),v="mindmap.json",j=document.createElement("a");j.setAttribute("href",S),j.setAttribute("download",v),j.click(),p(!1)},J=async()=>{f.current&&await f.current.exportAsPDF(),p(!1)},z=async()=>{f.current&&await f.current.exportAsPNG(),p(!1)},V=async()=>{f.current&&await f.current.exportAsJPEG(),p(!1)},Z=C=>{var v;const S=(v=C.target.files)==null?void 0:v[0];if(S){const j=new FileReader;j.onload=Y=>{var G;try{const I=JSON.parse((G=Y.target)==null?void 0:G.result);m(I)}catch(I){console.error("Ошибка при импорте файла:",I),alert("Ошибка при импорте файла. Проверьте формат файла.")}},j.readAsText(S)}},q=()=>{p(!$)};return a.jsxs("div",{className:"app",children:[a.jsx("a",{href:"https://github.com/lelkaklel/mindmapr",className:"github-corner","aria-label":"Просмотреть исходный код на GitHub",children:a.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",bottom:0,border:0,right:0,transform:"scale(1, -1)"},"aria-hidden":"true",children:[a.jsx("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),a.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),a.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})}),a.jsxs("header",{className:"app-header",children:[a.jsx("h1",{children:"MindMapr - Редактор диаграмм связей"}),a.jsxs("div",{className:"app-controls",children:[a.jsxs("div",{className:"export-menu-container",children:[a.jsx("button",{onClick:q,ref:i,className:"export-button",children:"Экспорт"}),$&&a.jsxs("div",{className:"export-menu",ref:u,children:[a.jsx("button",{onClick:O,children:"JSON"}),a.jsx("button",{onClick:J,children:"PDF"}),a.jsx("button",{onClick:z,children:"PNG"}),a.jsx("button",{onClick:V,children:"JPEG"})]})]}),a.jsxs("label",{className:"import-button",children:["Импорт",a.jsx("input",{type:"file",accept:".json",onChange:Z,style:{display:"none"}})]}),a.jsx("button",{onClick:X,className:"reset-button",children:"Очистить"})]})]}),a.jsx("main",{className:"app-main",children:a.jsx("div",{className:"mind-map-container",children:a.jsx(Ct,{data:R,onNodeClick:x,onNodeUpdate:M,onNodeDelete:et,exportRef:f})})})]})};tt.createRoot(document.getElementById("root")).render(a.jsx(dt.StrictMode,{children:a.jsx(bt,{})}));
