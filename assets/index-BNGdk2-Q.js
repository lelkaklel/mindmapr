import{r as j,a as lt,R as dt}from"./react-DJ1oPbzn.js";import{s as _,z as ht,i as K,h as ut,t as T,a as W}from"./d3-CSd-2QcB.js";import{h as Q,F as nt,E as ft}from"./vendor-B5CLxLTD.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))g(d);new MutationObserver(d=>{for(const a of d)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&g(h)}).observe(document,{childList:!0,subtree:!0});function B(d){const a={};return d.integrity&&(a.integrity=d.integrity),d.referrerPolicy&&(a.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?a.credentials="include":d.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function g(d){if(d.ep)return;d.ep=!0;const a=B(d);fetch(d.href,a)}})();var at={exports:{}},H={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pt=j,gt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),xt=Object.prototype.hasOwnProperty,yt=pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wt={key:!0,ref:!0,__self:!0,__source:!0};function ct(R,p,B){var g,d={},a=null,h=null;B!==void 0&&(a=""+B),p.key!==void 0&&(a=""+p.key),p.ref!==void 0&&(h=p.ref);for(g in p)xt.call(p,g)&&!wt.hasOwnProperty(g)&&(d[g]=p[g]);if(R&&R.defaultProps)for(g in p=R.defaultProps,p)d[g]===void 0&&(d[g]=p[g]);return{$$typeof:gt,type:R,key:a,ref:h,props:d,_owner:yt.current}}H.Fragment=mt;H.jsx=ct;H.jsxs=ct;at.exports=H;var s=at.exports,tt={},rt=lt;tt.createRoot=rt.createRoot,tt.hydrateRoot=rt.hydrateRoot;const F=200,ot=80,st={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},Ct=({data:R,onNodeClick:p,onNodeUpdate:B,onNodeDelete:g,exportRef:d})=>{const a=j.useRef(null),h=j.useRef(null),[x,P]=j.useState(null),[et,X]=j.useState(1),[O,J]=j.useState({width:0,height:0}),Y=()=>{if(h.current){const{width:t,height:w}=h.current.getBoundingClientRect();J({width:t,height:w})}},V=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=_(a.current),w=t.select("g"),b=T(t.node()),v=h.current.getBoundingClientRect(),o=v.width,i=v.height,c=document.createElement("div");document.body.appendChild(c),c.style.position="absolute",c.style.left="-9999px",c.style.width="1200px",c.style.height="842px";const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width","1200"),l.setAttribute("height","842"),l.setAttribute("viewBox","0 0 1200 842");const E=document.createElementNS("http://www.w3.org/2000/svg","g"),u=w.node();if(u){Array.from(u.childNodes).forEach(q=>{E.appendChild(q.cloneNode(!0))});const r=40,e=u.getBBox(),n=(1200-r*2)/e.width,f=(842-r*2)/e.height,m=Math.min(n,f,2),$=1200/2,k=842/2,L=`translate(${$}, ${k}) scale(${m}) translate(${-e.x-e.width/2}, ${-e.y-e.height/2})`;E.setAttribute("transform",L),l.appendChild(E),c.appendChild(l)}const y=await Q(c,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(c);const D=new ft({orientation:"landscape",unit:"mm",format:"a4"}),M=y.toDataURL("image/jpeg",1);D.addImage(M,"JPEG",0,0,297,210),D.save("mind_map.pdf")}catch(t){console.error("Ошибка при экспорте в PDF:",t)}}},U=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=_(a.current),w=t.select("g"),b=T(t.node()),v=h.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","1500"),i.setAttribute("height","1000"),i.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=w.node();if(l){Array.from(l.childNodes).forEach(m=>{c.appendChild(m.cloneNode(!0))});const u=50,y=l.getBBox(),D=(1500-u*2)/y.width,M=(1e3-u*2)/y.height,r=Math.min(D,M,2),e=1500/2,n=1e3/2,f=`translate(${e}, ${n}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;c.setAttribute("transform",f),i.appendChild(c),o.appendChild(i)}const E=await Q(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),E.toBlob(u=>{u&&nt.saveAs(u,"mind_map.png")},"image/png")}catch(t){console.error("Ошибка при экспорте в PNG:",t)}}},Z=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=_(a.current),w=t.select("g"),b=T(t.node()),v=h.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","1500"),i.setAttribute("height","1000"),i.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=w.node();if(l){Array.from(l.childNodes).forEach(m=>{c.appendChild(m.cloneNode(!0))});const u=50,y=l.getBBox(),D=(1500-u*2)/y.width,M=(1e3-u*2)/y.height,r=Math.min(D,M,2),e=1500/2,n=1e3/2,f=`translate(${e}, ${n}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;c.setAttribute("transform",f),i.appendChild(c),o.appendChild(i)}const E=await Q(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),E.toBlob(u=>{u&&nt.saveAs(u,"mind_map.jpg")},"image/jpeg",.9)}catch(t){console.error("Ошибка при экспорте в JPEG:",t)}}};j.useEffect(()=>{d&&(d.current={exportAsPDF:V,exportAsPNG:U,exportAsJPEG:Z})},[d]),j.useEffect(()=>(Y(),window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)),[]);const C=(t,w,b)=>{const v=w/2,o=b/2,i=l=>!l.children||l.children.length===0?ot:Math.max(ot,W(l.children,E=>i(E))),c=(l,E,u,y=!1,D=b,M=o,r=0)=>{if(l.y=E,l.x=u,!l.children||l.children.length===0)return;const e=[...l.children].sort((m,$)=>{const k=i(m);return i($)-k}),n=W(e,m=>i(m));let f=u-n/2;e.forEach(m=>{const $=i(m),k=f+$/2,L=y?E-F:E+F;c(m,L,k,y,$,u,r+1),f+=$})};if(t.x=o,t.y=v,t.children&&t.children.length>0){const l=Math.ceil(t.children.length/2);t.children.length-l;const E=t.children.slice(0,l),u=t.children.slice(l),y=W(E,e=>i(e)),D=W(u,e=>i(e));let M=o-y/2;E.forEach(e=>{const n=i(e),f=M+n/2;c(e,v-F,f,!0,n,o,1),M+=n});let r=o-D/2;u.forEach(e=>{const n=i(e),f=r+n/2;c(e,v+F,f,!1,n,o,1),r+=n})}return t},A=(t,w=14)=>t.length*w*.6+10,N=t=>st[t.toString()]||st.default,S=()=>{if(!x)return;const t={id:Date.now().toString(),text:"Новый узел",children:[]};x.node.children.push(t),B&&B(x.node),P(null)},G=()=>{!x||x.depth===0||!x.parentId||g&&(g(x.node.id,x.parentId),P(null))},I=()=>{if(!x||!B)return;const t={...x.node,text:x.text};B(t),P(null)};j.useEffect(()=>{if(!a.current||!h.current||!R||O.width===0)return;const t=O.width,w=O.height;_(a.current).selectAll("*").remove();const b=_(a.current).attr("width",t).attr("height",w),v=b.append("g"),o=ht().scaleExtent([.1,3]).on("zoom",r=>{v.attr("transform",r.transform),X(r.transform.k)});b.call(o);const i=b.append("g").attr("class","zoom-controls").attr("transform",`translate(${t-35}, 20)`);i.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{b.transition().duration(300).call(o.scaleBy,1.2)}),i.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),i.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{b.transition().duration(300).call(o.scaleBy,.8)}),i.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),i.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const r=v.node();if(r){const e=r.getBBox(),n=40,f=(t-n*2)/e.width,m=(w-n*2)/e.height,$=Math.min(f,m,.8),k=t/2,L=w/2,q=K.translate(k,L).scale($).translate(-e.x-e.width/2,-e.y-e.height/2);b.transition().duration(500).call(o.transform,q)}}),i.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const c=ut(R.root);C(c,t,w);const l=v.append("g").attr("class","links-layer"),E=v.append("g").attr("class","nodes-layer"),u=(r,e)=>{const n=e?r.source:r.target,f=N(n.depth),m=n.y<t/2,k=(A(n.data.text,f.fontSize)+f.padding*2)/2;return f.height/2,e?r.target.y<n.y?{x:n.y-k,y:n.x}:{x:n.y+k,y:n.x}:m?{x:n.y+k,y:n.x}:{x:n.y-k,y:n.x}},y=r=>{const e=u(r,!0),n=u(r,!1);return`M${e.x},${e.y} Q${(e.x+n.x)/2},${e.y} ${(e.x+n.x)/2},${(e.y+n.y)/2} Q${(e.x+n.x)/2},${n.y} ${n.x},${n.y}`};l.selectAll(".link").data(c.links()).enter().append("path").attr("class","link").attr("d",r=>y(r)).style("fill","none").style("stroke",r=>r.target.depth===1?"#666":"#999").style("stroke-width",r=>{const e=r.target.depth;return Math.max(1,6-e*1.5)+"px"});const D=E.selectAll(".node").data(c.descendants()).enter().append("g").attr("class","node").attr("transform",r=>`translate(${r.y},${r.x})`);D.each(function(r){const e=_(this),n=N(r.depth);r.y<t/2;const f=A(r.data.text,n.fontSize)+n.padding*2,m=n.height;e.append("rect").attr("x",-f/2).attr("y",-m/2).attr("width",f).attr("height",m).attr("rx",5).attr("ry",5).style("fill",n.fill).style("stroke",n.stroke).style("stroke-width",n.strokeWidth),e.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${n.fontSize}px`).style("font-weight",n.fontWeight).style("fill",n.textColor).text(r.data.text)}),D.on("click",(r,e)=>{var k;r.stopPropagation(),(k=h.current)==null||k.getBoundingClientRect();const n=T(b.node()),f=e.y*n.k+n.x,m=e.x*n.k+n.y;let $;e.parent&&($=e.parent.data.id),P({node:e.data,text:e.data.text,position:{x:f,y:m},parentId:$,depth:e.depth}),p&&p(e.data)}),b.on("click",()=>{P(null)});const M=v.node();if(M){const r=M.getBBox(),e=40,n=(t-e*2)/r.width,f=(w-e*2)/r.height,m=Math.min(n,f,.8),$=t/2,k=w/2,L=K.translate($,k).scale(m).translate(-r.x-r.width/2,-r.y-r.height/2);b.call(o.transform,L)}else{const r=K.translate(t/2,w/2).scale(.8);b.call(o.transform,r)}},[R,p,B,g,O]);const z=()=>{if(!x||!h.current)return{};const t=h.current.getBoundingClientRect(),w=x.position.x<O.width/2;N(x.depth);let b=w?-250:50,v=x.position.x+b;const o=250,i=120;v<0&&(v=10),v+o>t.width&&(v=t.width-o-10);let c=x.position.y-i/2;return c<0&&(c=10),c+i>t.height&&(c=t.height-i-10),{position:"absolute",left:`${v}px`,top:`${c}px`,zIndex:1e3}};return s.jsxs("div",{className:"mind-map-wrapper",ref:h,children:[s.jsx("svg",{ref:a}),x&&s.jsxs("div",{className:"edit-node-panel",style:z(),children:[s.jsx("input",{type:"text",value:x.text,onChange:t=>P({...x,text:t.target.value}),onKeyPress:t=>t.key==="Enter"&&I(),autoFocus:!0}),s.jsxs("div",{className:"edit-node-buttons buttons-row",children:[s.jsx("button",{onClick:I,className:"save-button",children:"Сохранить"}),s.jsx("button",{onClick:S,className:"add-button",children:"+"}),x.depth!==0&&s.jsx("button",{onClick:G,className:"delete-button",children:"×"}),s.jsx("button",{onClick:()=>P(null),className:"cancel-button",children:"Отмена"})]})]})]})},it={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},vt=()=>{const[R,p]=j.useState(()=>{const C=localStorage.getItem("mindMapData");return C?JSON.parse(C):it}),[B,g]=j.useState(!1),d=j.useRef(null),a=j.useRef(null),h=j.useRef(null);j.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify(R))},[R]),j.useEffect(()=>{const C=A=>{d.current&&a.current&&!d.current.contains(A.target)&&!a.current.contains(A.target)&&g(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]);const x=C=>{console.log("Выбран узел:",C)},P=C=>{const A=N=>N.id===C.id?C:{...N,children:N.children.map(A)};p(N=>({root:A(N.root)}))},et=(C,A)=>{const N=S=>S.id===A?{...S,children:S.children.filter(G=>G.id!==C)}:{...S,children:S.children.map(N)};p(S=>({root:N(S.root)}))},X=()=>{const C={root:{id:R.root.id,text:it.root.text,children:[]}};p(C)},O=()=>{const C=JSON.stringify(R,null,2),A="data:application/json;charset=utf-8,"+encodeURIComponent(C),N="mindmap.json",S=document.createElement("a");S.setAttribute("href",A),S.setAttribute("download",N),S.click(),g(!1)},J=async()=>{h.current&&await h.current.exportAsPDF(),g(!1)},Y=async()=>{h.current&&await h.current.exportAsPNG(),g(!1)},V=async()=>{h.current&&await h.current.exportAsJPEG(),g(!1)},U=C=>{var N;const A=(N=C.target.files)==null?void 0:N[0];if(A){const S=new FileReader;S.onload=G=>{var I;try{const z=JSON.parse((I=G.target)==null?void 0:I.result);p(z)}catch(z){console.error("Ошибка при импорте файла:",z),alert("Ошибка при импорте файла. Проверьте формат файла.")}},S.readAsText(A)}},Z=()=>{g(!B)};return s.jsxs("div",{className:"app",children:[s.jsx("a",{href:"https://github.com/lelkaklel/mindmapr",className:"github-corner","aria-label":"Просмотреть исходный код на GitHub",children:s.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",bottom:0,border:0,right:0,transform:"scale(1, -1)"},"aria-hidden":"true",children:[s.jsx("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),s.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),s.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})}),s.jsxs("header",{className:"app-header",children:[s.jsx("h1",{children:s.jsx("span",{children:"MindMapr - Редактор диаграмм связей"})}),s.jsxs("div",{className:"app-controls",children:[s.jsxs("div",{className:"export-menu-container",children:[s.jsx("button",{onClick:Z,ref:a,className:"export-button",children:"Экспорт"}),B&&s.jsxs("div",{className:"export-menu",ref:d,children:[s.jsx("button",{onClick:O,children:"JSON"}),s.jsx("button",{onClick:J,children:"PDF"}),s.jsx("button",{onClick:Y,children:"PNG"}),s.jsx("button",{onClick:V,children:"JPEG"})]})]}),s.jsxs("label",{className:"import-button",children:["Импорт",s.jsx("input",{type:"file",accept:".json",onChange:U,style:{display:"none"}})]}),s.jsx("button",{onClick:X,className:"reset-button",children:"Очистить"})]})]}),s.jsx("main",{className:"app-main",children:s.jsx("div",{className:"mind-map-container",children:s.jsx(Ct,{data:R,onNodeClick:x,onNodeUpdate:P,onNodeDelete:et,exportRef:h})})})]})};tt.createRoot(document.getElementById("root")).render(s.jsx(dt.StrictMode,{children:s.jsx(vt,{})}));
