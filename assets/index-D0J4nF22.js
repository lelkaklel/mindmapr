import{r as v,a as ut,R as pt}from"./react-DJ1oPbzn.js";import{t as nt,s as q,z as mt,i as rt,h as gt,a as U}from"./d3-CSd-2QcB.js";import{h as ot,F as at,E as xt}from"./vendor-B5CLxLTD.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))m(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const x of c.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&m(x)}).observe(document,{childList:!0,subtree:!0});function D(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function m(a){if(a.ep)return;a.ep=!0;const c=D(a);fetch(a.href,c)}})();var ht={exports:{}},K={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=v,wt=Symbol.for("react.element"),vt=Symbol.for("react.fragment"),bt=Object.prototype.hasOwnProperty,Ct=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kt={key:!0,ref:!0,__self:!0,__source:!0};function ft(j,p,D){var m,a={},c=null,x=null;D!==void 0&&(c=""+D),p.key!==void 0&&(c=""+p.key),p.ref!==void 0&&(x=p.ref);for(m in p)bt.call(p,m)&&!kt.hasOwnProperty(m)&&(a[m]=p[m]);if(j&&j.defaultProps)for(m in p=j.defaultProps,p)a[m]===void 0&&(a[m]=p[m]);return{$$typeof:wt,type:j,key:c,ref:x,props:a,_owner:Ct.current}}K.Fragment=vt;K.jsx=ft;K.jsxs=ft;ht.exports=K;var s=ht.exports,st={},it=ut;st.createRoot=it.createRoot,st.hydrateRoot=it.hydrateRoot;const Z=200,ct=80,lt={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},Et=({data:j,onNodeClick:p,onNodeUpdate:D,onNodeDelete:m,exportRef:a})=>{const c=v.useRef(null),x=v.useRef(null),[f,L]=v.useState(null),[T,Q]=v.useState(1),[I,V]=v.useState({width:0,height:0}),B=v.useRef(null),G=t=>{B.current=t,localStorage.setItem("mindmap-transform",JSON.stringify({x:t.x,y:t.y,k:t.k}))},tt=()=>{try{const t=localStorage.getItem("mindmap-transform");if(t){const{x:o,y:k,k:i}=JSON.parse(t);return rt.translate(o,k).scale(i)}}catch(t){console.error("Ошибка при загрузке трансформации:",t)}return null},W=()=>{if(x.current){const{width:t,height:o}=x.current.getBoundingClientRect();V({width:t,height:o})}},H=async()=>{if(!(!c.current||!x.current)){L(null),await new Promise(t=>setTimeout(t,100));try{const t=q(c.current),o=t.select("g"),k=nt(t.node()),i=x.current.getBoundingClientRect(),y=i.width,g=i.height,w=document.body.classList.contains("dark-theme"),l=document.createElement("div");document.body.appendChild(l),l.style.position="absolute",l.style.left="-9999px",l.style.width="1200px",l.style.height="842px",l.style.backgroundColor=w?"#333":"#ffffff";const d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width","1200"),d.setAttribute("height","842"),d.setAttribute("viewBox","0 0 1200 842"),w&&(d.style.backgroundColor="#333");const u=document.createElementNS("http://www.w3.org/2000/svg","g"),$=o.node();if($){Array.from($.childNodes).forEach(_=>{u.appendChild(_.cloneNode(!0))});const n=40,e=$.getBBox(),r=(1200-n*2)/e.width,b=(842-n*2)/e.height,E=Math.min(r,b,2),M=1200/2,N=842/2,Y=`translate(${M}, ${N}) scale(${E}) translate(${-e.x-e.width/2}, ${-e.y-e.height/2})`;u.setAttribute("transform",Y),d.appendChild(u),l.appendChild(d)}const A=await ot(l,{scale:2,backgroundColor:w?"#333":"#ffffff",logging:!1});document.body.removeChild(l);const P=new xt({orientation:"landscape",unit:"mm",format:"a4"}),z=A.toDataURL("image/jpeg",1);P.addImage(z,"JPEG",0,0,297,210),P.save("mind_map.pdf")}catch(t){console.error("Ошибка при экспорте в PDF:",t)}}},F=async()=>{if(!c.current||!x.current)return;L(null);const t=document.body.classList.contains("dark-theme");await new Promise(o=>setTimeout(o,100));try{const o=c.current,k=o.getBoundingClientRect(),{width:i,height:y}=k,l=new XMLSerializer().serializeToString(o).replace(/width=".*?"/,`width="${i}"`).replace(/height=".*?"/,`height="${y}"`).replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'),d=document.createElement("div");d.innerHTML=l,d.style.position="absolute",d.style.left="-9999px",document.body.appendChild(d);const u=d.querySelector("svg");u&&(u.style.backgroundColor=t?"#333":"#ffffff",u.setAttribute("width",`${i}px`),u.setAttribute("height",`${y}px`),(await ot(u,{backgroundColor:t?"#333":"#ffffff",scale:2,logging:!1})).toBlob(function(A){A&&at.saveAs(A,"mind_map.png")},"image/png")),document.body.removeChild(d)}catch(o){console.error("Ошибка при экспорте в PNG:",o)}},J=async()=>{if(!c.current||!x.current)return;L(null);const t=document.body.classList.contains("dark-theme");await new Promise(o=>setTimeout(o,100));try{const o=c.current,k=o.getBoundingClientRect(),{width:i,height:y}=k,l=new XMLSerializer().serializeToString(o).replace(/width=".*?"/,`width="${i}"`).replace(/height=".*?"/,`height="${y}"`).replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'),d=document.createElement("div");d.innerHTML=l,d.style.position="absolute",d.style.left="-9999px",document.body.appendChild(d);const u=d.querySelector("svg");u&&(u.style.backgroundColor=t?"#333":"#ffffff",u.setAttribute("width",`${i}px`),u.setAttribute("height",`${y}px`),(await ot(u,{backgroundColor:t?"#333":"#ffffff",scale:2,logging:!1})).toBlob(function(A){A&&at.saveAs(A,"mind_map.jpeg")},"image/jpeg",.95)),document.body.removeChild(d)}catch(o){console.error("Ошибка при экспорте в JPEG:",o)}};v.useEffect(()=>(a&&(a.current={exportAsPDF:H,exportAsPNG:F,exportAsJPEG:J}),()=>{a&&(a.current=null)}),[a,H,F,J]),v.useEffect(()=>{W();const t=()=>{W()};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),v.useEffect(()=>{W()},[]);const et=(t,o,k)=>{const i=o/2,y=k/2,g=l=>!l.children||l.children.length===0?ct:Math.max(ct,U(l.children,d=>g(d))),w=(l,d,u,$=!1,A=k,P=y,z=0)=>{if(l.y=d,l.x=u,!l.children||l.children.length===0)return;const n=[...l.children].sort((b,E)=>{const M=g(b);return g(E)-M}),e=U(n,b=>g(b));let r=u-e/2;n.forEach(b=>{const E=g(b),M=r+E/2,N=$?d-Z:d+Z;w(b,N,M,$,E,u,z+1),r+=E})};if(t.x=y,t.y=i,t.children&&t.children.length>0){const l=Math.ceil(t.children.length/2);t.children.length-l;const d=t.children.slice(0,l),u=t.children.slice(l),$=U(d,n=>g(n)),A=U(u,n=>g(n));let P=y-$/2;d.forEach(n=>{const e=g(n),r=P+e/2;w(n,i-Z,r,!0,e,y,1),P+=e});let z=y-A/2;u.forEach(n=>{const e=g(n),r=z+e/2;w(n,i+Z,r,!1,e,y,1),z+=e})}return t},h=(t,o=14)=>t.length*o*.6+10,C=t=>lt[t.toString()]||lt.default,R=()=>{if(!f)return;const t={id:Date.now().toString(),text:"Новый узел",children:[]};f.node.children.push(t),D&&D(f.node),L(null)},S=()=>{!f||f.depth===0||!f.parentId||m&&(m(f.node.id,f.parentId),L(null))},O=()=>{if(!f||!D)return;const t={...f.node,text:f.text};if(c.current){const o=q(c.current).select(`g.node[data-id="${t.id}"]`);if(!o.empty()){o.select("text").text(t.text);const k=C(f.depth),i=h(t.text,k.fontSize)+k.padding*2;o.select("rect").attr("x",-i/2).attr("width",i)}}D(t),L(null)};v.useEffect(()=>{if(!c.current||!x.current||!j)return;const{width:t,height:o}=I;let k=null;if(c.current)try{k=nt(c.current),k&&(B.current=k)}catch(n){console.log("Ошибка при получении трансформации:",n)}const i=q(c.current).attr("width",t).attr("height",o);i.selectAll("*").remove();const y=i.append("g"),g=mt().scaleExtent([.1,3]).on("zoom",n=>{y.attr("transform",n.transform),Q(n.transform.k),G(n.transform)});i.call(g);const w=i.append("g").attr("class","zoom-controls").attr("transform",`translate(${t-35}, 30)`);w.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{i.transition().duration(300).call(g.scaleBy,1.2)}),w.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),w.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{i.transition().duration(300).call(g.scaleBy,.8)}),w.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),w.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const n=y.node();if(n){const e=n.getBBox(),r=40,b=(t-r*2)/e.width,E=(o-r*2)/e.height,M=Math.min(b,E,.8),N=t/2,Y=o/2,_=rt.translate(N,Y).scale(M).translate(-e.x-e.width/2,-e.y-e.height/2);i.call(g.transform,_)}}),w.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const l=gt(j.root);et(l,t,o);const d=y.append("g").attr("class","links-layer"),u=y.append("g").attr("class","nodes-layer"),$=(n,e)=>{const r=e?n.source:n.target,b=C(r.depth),E=r.y<t/2,N=(h(r.data.text,b.fontSize)+b.padding*2)/2;return b.height/2,e?n.target.y<r.y?{x:r.y-N,y:r.x}:{x:r.y+N,y:r.x}:E?{x:r.y+N,y:r.x}:{x:r.y-N,y:r.x}},A=n=>{const e=$(n,!0),r=$(n,!1);return`M${e.x},${e.y} Q${(e.x+r.x)/2},${e.y} ${(e.x+r.x)/2},${(e.y+r.y)/2} Q${(e.x+r.x)/2},${r.y} ${r.x},${r.y}`};d.selectAll(".link").data(l.links()).enter().append("path").attr("class","link").attr("d",n=>A(n)).style("fill","none").style("stroke",n=>n.target.depth===1?"#666":"#999").style("stroke-width",n=>{const e=n.target.depth;return Math.max(1,6-e*1.5)+"px"});const P=u.selectAll(".node").data(l.descendants()).enter().append("g").attr("class","node").attr("transform",n=>`translate(${n.y},${n.x})`);P.each(function(n){const e=q(this),r=C(n.depth);n.y<t/2;const b=h(n.data.text,r.fontSize)+r.padding*2,E=r.height;e.append("rect").attr("x",-b/2).attr("y",-E/2).attr("width",b).attr("height",E).attr("rx",5).attr("ry",5).style("fill",r.fill).style("stroke",r.stroke).style("stroke-width",r.strokeWidth),e.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${r.fontSize}px`).style("font-weight",r.fontWeight).style("fill",r.textColor).text(n.data.text)}),P.on("click",(n,e)=>{var N;n.stopPropagation(),(N=x.current)==null||N.getBoundingClientRect();const r=nt(i.node()),b=e.y*r.k+r.x,E=e.x*r.k+r.y;let M;e.parent&&(M=e.parent.data.id),L({node:e.data,text:e.data.text,position:{x:b,y:E},parentId:M,depth:e.depth}),p&&p(e.data)}),i.on("click",()=>{L(null)}),P.attr("data-id",n=>n.data.id);const z=k||B.current||tt();if(z)i.call(g.transform,z);else{const n=y.node();if(n){const e=n.getBBox(),r=40,b=(t-r*2)/e.width,E=(o-r*2)/e.height,M=Math.min(b,E,.8),N=t/2,Y=o/2,_=rt.translate(N,Y).scale(M).translate(-e.x-e.width/2,-e.y-e.height/2);i.call(g.transform,_),G(_)}}},[j,p,D,m,I]);const X=()=>{if(!f||!x.current)return{};const t=x.current.getBoundingClientRect(),o=f.position.x<I.width/2;C(f.depth);let k=o?-250:50,i=f.position.x+k;const y=250,g=120;i<0&&(i=10),i+y>t.width&&(i=t.width-y-10);let w=f.position.y-g/2;return w<0&&(w=10),w+g>t.height&&(w=t.height-g-10),{position:"absolute",left:`${i}px`,top:`${w}px`,zIndex:1e3}};return s.jsxs("div",{className:"mind-map-wrapper",ref:x,children:[s.jsx("svg",{ref:c}),f&&s.jsxs("div",{className:"edit-node-panel",style:X(),children:[s.jsx("input",{type:"text",value:f.text,onChange:t=>L({...f,text:t.target.value}),onKeyPress:t=>t.key==="Enter"&&O(),autoFocus:!0}),s.jsxs("div",{className:"edit-node-buttons buttons-row",children:[s.jsx("button",{onClick:O,className:"save-button",children:"Сохранить"}),s.jsx("button",{onClick:R,className:"add-button",children:"+"}),f.depth!==0&&s.jsx("button",{onClick:S,className:"delete-button",children:"×"}),s.jsx("button",{onClick:()=>L(null),className:"cancel-button",children:"Отмена"})]})]})]})},dt={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},St=()=>{const[j,p]=v.useState(()=>{const h=localStorage.getItem("mindMapData");return h?JSON.parse(h):dt}),[D,m]=v.useState(!1),[a,c]=v.useState(!1),x=v.useRef(null),f=v.useRef(null),L=v.useRef(null),T=v.useRef(null);v.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify(j))},[j]),v.useEffect(()=>{const h=localStorage.getItem("mindmap-theme");if(h)c(h==="dark");else{const C=window.matchMedia("(prefers-color-scheme: dark)").matches;c(C)}},[]),v.useEffect(()=>{a?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme"),localStorage.setItem("mindmap-theme",a?"dark":"light")},[a]),v.useEffect(()=>{const h=C=>{x.current&&f.current&&!x.current.contains(C.target)&&!f.current.contains(C.target)&&m(!1)};return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[]);const Q=h=>{console.log("Выбран узел:",h)},I=h=>{const C=R=>R.id===h.id?h:{...R,children:R.children.map(C)};p(R=>({root:C(R.root)}))},V=(h,C)=>{const R=S=>S.id===C?{...S,children:S.children.filter(O=>O.id!==h)}:{...S,children:S.children.map(R)};p(S=>({root:R(S.root)}))},B=()=>{const h={root:{id:j.root.id,text:dt.root.text,children:[]}};p(h)},G=()=>{const h=JSON.stringify(j,null,2),C="data:application/json;charset=utf-8,"+encodeURIComponent(h),R="mindmap.json",S=document.createElement("a");S.setAttribute("href",C),S.setAttribute("download",R),S.click(),m(!1)},tt=async()=>{T.current&&await T.current.exportAsPDF(),m(!1)},W=async()=>{T.current&&await T.current.exportAsPNG(),m(!1)},H=async()=>{T.current&&await T.current.exportAsJPEG(),m(!1)},F=h=>{var R;const C=(R=h.target.files)==null?void 0:R[0];if(C){const S=new FileReader;S.onload=O=>{var X;try{const t=JSON.parse((X=O.target)==null?void 0:X.result);p(t)}catch(t){console.error("Ошибка при импорте файла:",t),alert("Ошибка при импорте файла. Проверьте формат файла.")}},S.readAsText(C)}},J=()=>{m(!D)},et=()=>{c(!a)};return s.jsxs("div",{className:`app ${a?"dark-theme":""}`,children:[s.jsx("a",{href:"https://github.com/lelkaklel/mindmapr",className:"github-corner","aria-label":"Просмотреть исходный код на GitHub",children:s.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 250 250",style:{fill:a?"#2c3e50":"#151513",color:a?"#151513":"#fff",position:"absolute",bottom:0,border:0,right:0,transform:"scale(1, -1)"},"aria-hidden":"true",children:[s.jsx("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),s.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),s.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})}),s.jsxs("header",{className:"app-header",children:[s.jsxs("div",{className:"top-container",children:[s.jsx("h1",{children:"MindMapr"}),s.jsx("div",{className:"controls"})]}),s.jsxs("div",{className:"app-controls",children:[s.jsxs("div",{className:"export-menu-container",children:[s.jsx("button",{onClick:J,ref:f,className:"control-button export-button","aria-label":"Экспорт",children:"📤"}),D&&s.jsxs("div",{className:"export-menu",ref:x,children:[s.jsx("button",{onClick:G,children:"JSON"}),s.jsx("button",{onClick:tt,children:"PDF"}),s.jsx("button",{onClick:W,children:"PNG"}),s.jsx("button",{onClick:H,children:"JPEG"})]})]}),s.jsx("input",{id:"file-input",type:"file",accept:".json",onChange:F,ref:L,style:{display:"none"}}),s.jsx("button",{onClick:()=>{var h;return(h=L.current)==null?void 0:h.click()},className:"control-button import-button","aria-label":"Импорт файла",children:"📥"}),s.jsx("button",{onClick:B,className:"control-button reset-button","aria-label":"Сброс",children:"🗑️"}),s.jsx("button",{onClick:et,className:"control-button theme-toggle","aria-label":"Переключить тему",children:a?"☀️":"🌙"})]})]}),s.jsx("main",{className:"app-main",children:s.jsx("div",{className:"mind-map-container",children:s.jsx(Et,{data:j,onNodeClick:Q,onNodeUpdate:I,onNodeDelete:V,exportRef:T})})})]})};st.createRoot(document.getElementById("root")).render(s.jsx(pt.StrictMode,{children:s.jsx(St,{})}));
