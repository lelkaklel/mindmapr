import{r as A,a as ct,R as lt}from"./react-DJ1oPbzn.js";import{s as L,z as dt,i as Q,h as ht,t as W,a as T}from"./d3-CSd-2QcB.js";import{h as U,F as et,E as ut}from"./vendor-DDqU_rgm.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))p(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&p(u)}).observe(document,{childList:!0,subtree:!0});function R(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function p(h){if(h.ep)return;h.ep=!0;const a=R(h);fetch(h.href,a)}})();var st={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft=A,pt=Symbol.for("react.element"),gt=Symbol.for("react.fragment"),mt=Object.prototype.hasOwnProperty,xt=ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yt={key:!0,ref:!0,__self:!0,__source:!0};function at($,m,R){var p,h={},a=null,u=null;R!==void 0&&(a=""+R),m.key!==void 0&&(a=""+m.key),m.ref!==void 0&&(u=m.ref);for(p in m)mt.call(m,p)&&!yt.hasOwnProperty(p)&&(h[p]=m[p]);if($&&$.defaultProps)for(p in m=$.defaultProps,m)h[p]===void 0&&(h[p]=m[p]);return{$$typeof:pt,type:$,key:a,ref:u,props:h,_owner:xt.current}}X.Fragment=gt;X.jsx=at;X.jsxs=at;st.exports=X;var f=st.exports,Z={},nt=ct;Z.createRoot=nt.createRoot,Z.hydrateRoot=nt.hydrateRoot;const F=200,rt=80,ot={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},wt=({data:$,onNodeClick:m,onNodeUpdate:R,onNodeDelete:p,exportRef:h})=>{const a=A.useRef(null),u=A.useRef(null),[x,M]=A.useState(null),[tt,H]=A.useState(1),[O,J]=A.useState({width:0,height:0}),Y=()=>{if(u.current){const{width:n,height:w}=u.current.getBoundingClientRect();J({width:n,height:w})}},V=async()=>{if(!(!a.current||!u.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=L(a.current),w=n.select("g"),S=W(n.node()),E=u.current.getBoundingClientRect(),o=E.width,s=E.height,i=document.createElement("div");document.body.appendChild(i),i.style.position="absolute",i.style.left="-9999px",i.style.width="1200px",i.style.height="842px";const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","1200"),c.setAttribute("height","842"),c.setAttribute("viewBox","0 0 1200 842");const N=document.createElementNS("http://www.w3.org/2000/svg","g"),g=w.node();if(g){Array.from(g.childNodes).forEach(K=>{N.appendChild(K.cloneNode(!0))});const r=40,t=g.getBBox(),e=(1200-r*2)/t.width,l=(842-r*2)/t.height,d=Math.min(e,l,2),j=1200/2,k=842/2,_=`translate(${j}, ${k}) scale(${d}) translate(${-t.x-t.width/2}, ${-t.y-t.height/2})`;N.setAttribute("transform",_),c.appendChild(N),i.appendChild(c)}const y=await U(i,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(i);const B=new ut({orientation:"landscape",unit:"mm",format:"a4"}),D=y.toDataURL("image/jpeg",1);B.addImage(D,"JPEG",0,0,297,210),B.save("mind_map.pdf")}catch(n){console.error("Ошибка при экспорте в PDF:",n)}}},q=async()=>{if(!(!a.current||!u.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=L(a.current),w=n.select("g"),S=W(n.node()),E=u.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const i=document.createElementNS("http://www.w3.org/2000/svg","g"),c=w.node();if(c){Array.from(c.childNodes).forEach(d=>{i.appendChild(d.cloneNode(!0))});const g=50,y=c.getBBox(),B=(1500-g*2)/y.width,D=(1e3-g*2)/y.height,r=Math.min(B,D,2),t=1500/2,e=1e3/2,l=`translate(${t}, ${e}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;i.setAttribute("transform",l),s.appendChild(i),o.appendChild(s)}const N=await U(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),N.toBlob(g=>{g&&et.saveAs(g,"mind_map.png")},"image/png")}catch(n){console.error("Ошибка при экспорте в PNG:",n)}}},b=async()=>{if(!(!a.current||!u.current)){M(null),await new Promise(n=>setTimeout(n,100));try{const n=L(a.current),w=n.select("g"),S=W(n.node()),E=u.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const i=document.createElementNS("http://www.w3.org/2000/svg","g"),c=w.node();if(c){Array.from(c.childNodes).forEach(d=>{i.appendChild(d.cloneNode(!0))});const g=50,y=c.getBBox(),B=(1500-g*2)/y.width,D=(1e3-g*2)/y.height,r=Math.min(B,D,2),t=1500/2,e=1e3/2,l=`translate(${t}, ${e}) scale(${r}) translate(${-y.x-y.width/2}, ${-y.y-y.height/2})`;i.setAttribute("transform",l),s.appendChild(i),o.appendChild(s)}const N=await U(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),N.toBlob(g=>{g&&et.saveAs(g,"mind_map.jpg")},"image/jpeg",.9)}catch(n){console.error("Ошибка при экспорте в JPEG:",n)}}};A.useEffect(()=>{h&&(h.current={exportAsPDF:V,exportAsPNG:q,exportAsJPEG:b})},[h]),A.useEffect(()=>(Y(),window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)),[]);const P=(n,w,S)=>{const E=w/2,o=S/2,s=c=>!c.children||c.children.length===0?rt:Math.max(rt,T(c.children,N=>s(N))),i=(c,N,g,y=!1,B=S,D=o,r=0)=>{if(c.y=N,c.x=g,!c.children||c.children.length===0)return;const t=[...c.children].sort((d,j)=>{const k=s(d);return s(j)-k}),e=T(t,d=>s(d));let l=g-e/2;t.forEach(d=>{const j=s(d),k=l+j/2,_=y?N-F:N+F;i(d,_,k,y,j,g,r+1),l+=j})};if(n.x=o,n.y=E,n.children&&n.children.length>0){const c=Math.ceil(n.children.length/2);n.children.length-c;const N=n.children.slice(0,c),g=n.children.slice(c),y=T(N,t=>s(t)),B=T(g,t=>s(t));let D=o-y/2;N.forEach(t=>{const e=s(t),l=D+e/2;i(t,E-F,l,!0,e,o,1),D+=e});let r=o-B/2;g.forEach(t=>{const e=s(t),l=r+e/2;i(t,E+F,l,!1,e,o,1),r+=e})}return n},C=(n,w=14)=>n.length*w*.6+10,v=n=>ot[n.toString()]||ot.default,I=()=>{if(!x)return;const n={id:Date.now().toString(),text:"Новый узел",children:[]};x.node.children.push(n),R&&R(x.node),M(null)},G=()=>{!x||x.depth===0||!x.parentId||p&&(p(x.node.id,x.parentId),M(null))},z=()=>{if(!x||!R)return;const n={...x.node,text:x.text};R(n),M(null)};A.useEffect(()=>{if(!a.current||!$||O.width===0)return;const n=O.width,w=O.height;L(a.current).selectAll("*").remove();const S=L(a.current).attr("width",n).attr("height",w),E=S.append("g"),o=dt().scaleExtent([.1,3]).on("zoom",r=>{E.attr("transform",r.transform),H(r.transform.k)});S.call(o);const s=S.append("g").attr("class","zoom-controls").attr("transform",`translate(${n-35}, 20)`);s.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{S.transition().duration(300).call(o.scaleBy,1.2)}),s.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),s.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{S.transition().duration(300).call(o.scaleBy,.8)}),s.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),s.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const r=E.node();if(r){const t=r.getBBox(),e=40,l=(n-e*2)/t.width,d=(w-e*2)/t.height,j=Math.min(l,d,.8),k=n/2,_=w/2,K=Q.translate(k,_).scale(j).translate(-t.x-t.width/2,-t.y-t.height/2);S.transition().duration(500).call(o.transform,K)}}),s.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const i=ht($.root);P(i,n,w);const c=E.append("g").attr("class","links-layer"),N=E.append("g").attr("class","nodes-layer"),g=(r,t)=>{const e=t?r.source:r.target,l=v(e.depth),d=e.y<n/2,k=(C(e.data.text,l.fontSize)+l.padding*2)/2;return l.height/2,t?r.target.y<e.y?{x:e.y-k,y:e.x}:{x:e.y+k,y:e.x}:d?{x:e.y+k,y:e.x}:{x:e.y-k,y:e.x}},y=r=>{const t=g(r,!0),e=g(r,!1);return`M${t.x},${t.y} Q${(t.x+e.x)/2},${t.y} ${(t.x+e.x)/2},${(t.y+e.y)/2} Q${(t.x+e.x)/2},${e.y} ${e.x},${e.y}`};c.selectAll(".link").data(i.links()).enter().append("path").attr("class","link").attr("d",y).style("fill","none").style("stroke",r=>r.target.depth===1?"#666":"#999").style("stroke-width",r=>{const t=r.target.depth;return Math.max(1,6-t*1.5)+"px"});const B=N.selectAll(".node").data(i.descendants()).enter().append("g").attr("class","node").attr("transform",r=>`translate(${r.y},${r.x})`);B.each(function(r){const t=L(this),e=v(r.depth);r.y<n/2;const l=C(r.data.text,e.fontSize)+e.padding*2,d=e.height;t.append("rect").attr("x",-l/2).attr("y",-d/2).attr("width",l).attr("height",d).attr("rx",5).attr("ry",5).style("fill",e.fill).style("stroke",e.stroke).style("stroke-width",e.strokeWidth),t.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${e.fontSize}px`).style("font-weight",e.fontWeight).style("fill",e.textColor).text(r.data.text)}),B.on("click",(r,t)=>{var k;r.stopPropagation(),(k=u.current)==null||k.getBoundingClientRect();const e=W(S.node()),l=t.y*e.k+e.x,d=t.x*e.k+e.y;let j;t.parent&&(j=t.parent.data.id),M({node:t.data,text:t.data.text,position:{x:l,y:d},parentId:j,depth:t.depth}),m&&m(t.data)}),S.on("click",()=>{M(null)}),B.append("g").attr("class","add-node-button").attr("transform",r=>{const t=r.y<n/2,e=v(r.depth),l=C(r.data.text,e.fontSize)+e.padding*2,d=Math.max(l/2+20,e.height+5);return`translate(${t?-d:d}, 0)`}).style("cursor","pointer").on("click",(r,t)=>{r.stopPropagation();const e={id:Date.now().toString(),text:"Новый узел",children:[]};t.data.children.push(e),R&&R(t.data)}).append("text").attr("dy",".35em").attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").style("fill","#4CAF50").text("+"),B.filter(r=>r.depth!==0).append("g").attr("class","delete-node-button").attr("transform",r=>{const t=r.y<n/2,e=v(r.depth),l=C(r.data.text,e.fontSize)+e.padding*2,d=Math.max(l/2+40,e.height+25);return`translate(${t?-d:d}, 0)`}).style("cursor","pointer").on("click",(r,t)=>{r.stopPropagation(),p&&t.parent&&p(t.data.id,t.parent.data.id)}).append("text").attr("dy",".35em").attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").style("fill","#f44336").text("×");const D=E.node();if(D){const r=D.getBBox(),t=40,e=(n-t*2)/r.width,l=(w-t*2)/r.height,d=Math.min(e,l,.8),j=n/2,k=w/2,_=Q.translate(j,k).scale(d).translate(-r.x-r.width/2,-r.y-r.height/2);S.call(o.transform,_)}else{const r=Q.translate(n/2,w/2).scale(.8);S.call(o.transform,r)}},[$,m,R,p,O]);const it=()=>{if(!x||!u.current)return{};const n=u.current.getBoundingClientRect(),w=x.position.x<O.width/2;v(x.depth);let S=w?-250:50,E=x.position.x+S;const o=250,s=120;E<0&&(E=10),E+o>n.width&&(E=n.width-o-10);let i=x.position.y-s/2;return i<0&&(i=10),i+s>n.height&&(i=n.height-s-10),{position:"absolute",left:`${E}px`,top:`${i}px`,zIndex:1e3}};return f.jsxs("div",{className:"mind-map-wrapper",ref:u,children:[f.jsx("svg",{ref:a}),x&&f.jsxs("div",{className:"edit-node-panel",style:it(),children:[f.jsx("input",{type:"text",value:x.text,onChange:n=>M({...x,text:n.target.value}),onKeyPress:n=>n.key==="Enter"&&z(),autoFocus:!0}),f.jsxs("div",{className:"edit-node-buttons buttons-row",children:[f.jsx("button",{onClick:z,className:"save-button",children:"Сохранить"}),f.jsx("button",{onClick:I,className:"add-button",children:"+"}),x.depth!==0&&f.jsx("button",{onClick:G,className:"delete-button",children:"×"}),f.jsx("button",{onClick:()=>M(null),className:"cancel-button",children:"Отмена"})]})]})]})},vt={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},Et=()=>{const[$,m]=A.useState(()=>{const b=localStorage.getItem("mindMapData");return b?JSON.parse(b):vt}),[R,p]=A.useState(!1),h=A.useRef(null),a=A.useRef(null),u=A.useRef(null);A.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify($))},[$]),A.useEffect(()=>{const b=P=>{h.current&&a.current&&!h.current.contains(P.target)&&!a.current.contains(P.target)&&p(!1)};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[]);const x=b=>{console.log("Выбран узел:",b)},M=b=>{const P=C=>C.id===b.id?b:{...C,children:C.children.map(P)};m(C=>({root:P(C.root)}))},tt=(b,P)=>{const C=v=>v.id===P?{...v,children:v.children.filter(I=>I.id!==b)}:{...v,children:v.children.map(C)};m(v=>({root:C(v.root)}))},H=()=>{const b=JSON.stringify($,null,2),P="data:application/json;charset=utf-8,"+encodeURIComponent(b),C="mindmap.json",v=document.createElement("a");v.setAttribute("href",P),v.setAttribute("download",C),v.click(),p(!1)},O=async()=>{u.current&&await u.current.exportAsPDF(),p(!1)},J=async()=>{u.current&&await u.current.exportAsPNG(),p(!1)},Y=async()=>{u.current&&await u.current.exportAsJPEG(),p(!1)},V=b=>{var C;const P=(C=b.target.files)==null?void 0:C[0];if(P){const v=new FileReader;v.onload=I=>{var G;try{const z=JSON.parse((G=I.target)==null?void 0:G.result);m(z)}catch(z){console.error("Ошибка при импорте файла:",z),alert("Ошибка при импорте файла. Проверьте формат файла.")}},v.readAsText(P)}},q=()=>{p(!R)};return f.jsxs("div",{className:"app",children:[f.jsxs("header",{className:"app-header",children:[f.jsx("h1",{children:"MindMapr - Редактор диаграмм связей"}),f.jsxs("div",{className:"app-controls",children:[f.jsxs("div",{className:"export-menu-container",children:[f.jsx("button",{onClick:q,ref:a,className:"export-button",children:"Экспорт"}),R&&f.jsxs("div",{className:"export-menu",ref:h,children:[f.jsx("button",{onClick:H,children:"JSON"}),f.jsx("button",{onClick:O,children:"PDF"}),f.jsx("button",{onClick:J,children:"PNG"}),f.jsx("button",{onClick:Y,children:"JPEG"})]})]}),f.jsxs("label",{className:"import-button",children:["Импорт",f.jsx("input",{type:"file",accept:".json",onChange:V,style:{display:"none"}})]})]})]}),f.jsx("main",{className:"app-main",children:f.jsx("div",{className:"mind-map-container",children:f.jsx(wt,{data:$,onNodeClick:x,onNodeUpdate:M,onNodeDelete:tt,exportRef:u})})})]})};Z.createRoot(document.getElementById("root")).render(f.jsx(lt.StrictMode,{children:f.jsx(Et,{})}));
