import{r as j,a as ht,R as ut}from"./react-DJ1oPbzn.js";import{s as T,z as ft,i as Q,h as pt,t as W,a as F}from"./d3-CSd-2QcB.js";import{h as tt,F as rt,E as gt}from"./vendor-B5CLxLTD.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))g(d);new MutationObserver(d=>{for(const a of d)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&g(h)}).observe(document,{childList:!0,subtree:!0});function B(d){const a={};return d.integrity&&(a.integrity=d.integrity),d.referrerPolicy&&(a.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?a.credentials="include":d.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function g(d){if(d.ep)return;d.ep=!0;const a=B(d);fetch(d.href,a)}})();var ct={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mt=j,xt=Symbol.for("react.element"),yt=Symbol.for("react.fragment"),wt=Object.prototype.hasOwnProperty,Ct=mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vt={key:!0,ref:!0,__self:!0,__source:!0};function lt(R,p,B){var g,d={},a=null,h=null;B!==void 0&&(a=""+B),p.key!==void 0&&(a=""+p.key),p.ref!==void 0&&(h=p.ref);for(g in p)wt.call(p,g)&&!vt.hasOwnProperty(g)&&(d[g]=p[g]);if(R&&R.defaultProps)for(g in p=R.defaultProps,p)d[g]===void 0&&(d[g]=p[g]);return{$$typeof:xt,type:R,key:a,ref:h,props:d,_owner:Ct.current}}X.Fragment=yt;X.jsx=lt;X.jsxs=lt;ct.exports=X;var i=ct.exports,et={},ot=ht;et.createRoot=ot.createRoot,et.hydrateRoot=ot.hydrateRoot;const H=200,st=80,it={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},bt=({data:R,onNodeClick:p,onNodeUpdate:B,onNodeDelete:g,exportRef:d})=>{const a=j.useRef(null),h=j.useRef(null),[m,P]=j.useState(null),[nt,J]=j.useState(1),[_,V]=j.useState({width:0,height:0}),Y=()=>{if(h.current){const{width:t,height:y}=h.current.getBoundingClientRect();V({width:t,height:y})}},K=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=T(a.current),y=t.select("g"),E=W(t.node()),C=h.current.getBoundingClientRect(),o=C.width,c=C.height,l=document.createElement("div");document.body.appendChild(l),l.style.position="absolute",l.style.left="-9999px",l.style.width="1200px",l.style.height="842px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1200"),s.setAttribute("height","842"),s.setAttribute("viewBox","0 0 1200 842");const v=document.createElementNS("http://www.w3.org/2000/svg","g"),f=y.node();if(f){Array.from(f.childNodes).forEach(M=>{v.appendChild(M.cloneNode(!0))});const $=40,u=f.getBBox(),e=(1200-$*2)/u.width,r=(842-$*2)/u.height,n=Math.min(e,r,2),b=1200/2,S=842/2,L=`translate(${b}, ${S}) scale(${n}) translate(${-u.x-u.width/2}, ${-u.y-u.height/2})`;v.setAttribute("transform",L),s.appendChild(v),l.appendChild(s)}const x=await tt(l,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(l);const D=new gt({orientation:"landscape",unit:"mm",format:"a4"}),O=x.toDataURL("image/jpeg",1);D.addImage(O,"JPEG",0,0,297,210),D.save("mind_map.pdf")}catch(t){console.error("Ошибка при экспорте в PDF:",t)}}},U=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=T(a.current),y=t.select("g"),E=W(t.node()),C=h.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","1500"),c.setAttribute("height","1000"),c.setAttribute("viewBox","0 0 1500 1000");const l=document.createElementNS("http://www.w3.org/2000/svg","g"),s=y.node();if(s){Array.from(s.childNodes).forEach(n=>{l.appendChild(n.cloneNode(!0))});const f=50,x=s.getBBox(),D=(1500-f*2)/x.width,O=(1e3-f*2)/x.height,$=Math.min(D,O,2),u=1500/2,e=1e3/2,r=`translate(${u}, ${e}) scale(${$}) translate(${-x.x-x.width/2}, ${-x.y-x.height/2})`;l.setAttribute("transform",r),c.appendChild(l),o.appendChild(c)}const v=await tt(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),v.toBlob(f=>{f&&rt.saveAs(f,"mind_map.png")},"image/png")}catch(t){console.error("Ошибка при экспорте в PNG:",t)}}},Z=async()=>{if(!(!a.current||!h.current)){P(null),await new Promise(t=>setTimeout(t,100));try{const t=T(a.current),y=t.select("g"),E=W(t.node()),C=h.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","1500"),c.setAttribute("height","1000"),c.setAttribute("viewBox","0 0 1500 1000");const l=document.createElementNS("http://www.w3.org/2000/svg","g"),s=y.node();if(s){Array.from(s.childNodes).forEach(n=>{l.appendChild(n.cloneNode(!0))});const f=50,x=s.getBBox(),D=(1500-f*2)/x.width,O=(1e3-f*2)/x.height,$=Math.min(D,O,2),u=1500/2,e=1e3/2,r=`translate(${u}, ${e}) scale(${$}) translate(${-x.x-x.width/2}, ${-x.y-x.height/2})`;l.setAttribute("transform",r),c.appendChild(l),o.appendChild(c)}const v=await tt(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),v.toBlob(f=>{f&&rt.saveAs(f,"mind_map.jpg")},"image/jpeg",.9)}catch(t){console.error("Ошибка при экспорте в JPEG:",t)}}};j.useEffect(()=>{d&&(d.current={exportAsPDF:K,exportAsPNG:U,exportAsJPEG:Z})},[d]),j.useEffect(()=>(Y(),window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)),[]);const w=(t,y,E)=>{const C=y/2,o=E/2,c=s=>!s.children||s.children.length===0?st:Math.max(st,F(s.children,v=>c(v))),l=(s,v,f,x=!1,D=E,O=o,$=0)=>{if(s.y=v,s.x=f,!s.children||s.children.length===0)return;const u=[...s.children].sort((n,b)=>{const S=c(n);return c(b)-S}),e=F(u,n=>c(n));let r=f-e/2;u.forEach(n=>{const b=c(n),S=r+b/2,L=x?v-H:v+H;l(n,L,S,x,b,f,$+1),r+=b})};if(t.x=o,t.y=C,t.children&&t.children.length>0){const s=Math.ceil(t.children.length/2);t.children.length-s;const v=t.children.slice(0,s),f=t.children.slice(s),x=F(v,u=>c(u)),D=F(f,u=>c(u));let O=o-x/2;v.forEach(u=>{const e=c(u),r=O+e/2;l(u,C-H,r,!0,e,o,1),O+=e});let $=o-D/2;f.forEach(u=>{const e=c(u),r=$+e/2;l(u,C+H,r,!1,e,o,1),$+=e})}return t},A=(t,y=14)=>t.length*y*.6+10,N=t=>it[t.toString()]||it.default,k=()=>{if(!m)return;const t={id:Date.now().toString(),text:"Новый узел",children:[]};m.node.children.push(t),B&&B(m.node),P(null)},G=()=>{!m||m.depth===0||!m.parentId||g&&(g(m.node.id,m.parentId),P(null))},I=()=>{if(!m||!B)return;const t={...m.node,text:m.text};B(t),P(null)};j.useEffect(()=>{if(!a.current||!h.current||!R)return;const{width:t,height:y}=_,E=T(a.current).attr("width",t).attr("height",y);E.selectAll("*").remove();const C=E.append("g"),o=ft().scaleExtent([.1,3]).on("zoom",e=>{C.attr("transform",e.transform),J(e.transform.k)});E.call(o);const c=e=>{e.touches.length===1&&e.preventDefault()},l=window.matchMedia("(max-width: 768px)").matches;l&&(o.filter(e=>!e.ctrlKey&&e.type!=="dblclick"),a.current.addEventListener("touchstart",c,{passive:!1}));const s=E.append("g").attr("class","zoom-controls").attr("transform",`translate(${t-35}, 20)`);s.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{E.transition().duration(300).call(o.scaleBy,1.2)}),s.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),s.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{E.transition().duration(300).call(o.scaleBy,.8)}),s.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),s.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const e=C.node();if(e){const r=e.getBBox(),n=40,b=(t-n*2)/r.width,S=(y-n*2)/r.height,L=Math.min(b,S,.8),M=t/2,q=y/2,dt=Q.translate(M,q).scale(L).translate(-r.x-r.width/2,-r.y-r.height/2);E.transition().duration(500).call(o.transform,dt)}}),s.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const v=pt(R.root);w(v,t,y);const f=C.append("g").attr("class","links-layer"),x=C.append("g").attr("class","nodes-layer"),D=(e,r)=>{const n=r?e.source:e.target,b=N(n.depth),S=n.y<t/2,M=(A(n.data.text,b.fontSize)+b.padding*2)/2;return b.height/2,r?e.target.y<n.y?{x:n.y-M,y:n.x}:{x:n.y+M,y:n.x}:S?{x:n.y+M,y:n.x}:{x:n.y-M,y:n.x}},O=e=>{const r=D(e,!0),n=D(e,!1);return`M${r.x},${r.y} Q${(r.x+n.x)/2},${r.y} ${(r.x+n.x)/2},${(r.y+n.y)/2} Q${(r.x+n.x)/2},${n.y} ${n.x},${n.y}`};f.selectAll(".link").data(v.links()).enter().append("path").attr("class","link").attr("d",O).style("fill","none").style("stroke",e=>e.target.depth===1?"#666":"#999").style("stroke-width",e=>{const r=e.target.depth;return Math.max(1,6-r*1.5)+"px"});const $=x.selectAll(".node").data(v.descendants()).enter().append("g").attr("class","node").attr("transform",e=>`translate(${e.y},${e.x})`);$.each(function(e){const r=T(this),n=N(e.depth);e.y<t/2;const b=A(e.data.text,n.fontSize)+n.padding*2,S=n.height;r.append("rect").attr("x",-b/2).attr("y",-S/2).attr("width",b).attr("height",S).attr("rx",5).attr("ry",5).style("fill",n.fill).style("stroke",n.stroke).style("stroke-width",n.strokeWidth),r.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${n.fontSize}px`).style("font-weight",n.fontWeight).style("fill",n.textColor).text(e.data.text)}),$.on("click",(e,r)=>{var M;e.stopPropagation(),(M=h.current)==null||M.getBoundingClientRect();const n=W(E.node()),b=r.y*n.k+n.x,S=r.x*n.k+n.y;let L;r.parent&&(L=r.parent.data.id),P({node:r.data,text:r.data.text,position:{x:b,y:S},parentId:L,depth:r.depth}),p&&p(r.data)}),E.on("click",()=>{P(null)});const u=C.node();if(u){const e=u.getBBox(),r=40,n=(t-r*2)/e.width,b=(y-r*2)/e.height,S=Math.min(n,b,.8),L=t/2,M=y/2,q=Q.translate(L,M).scale(S).translate(-e.x-e.width/2,-e.y-e.height/2);E.call(o.transform,q)}else{const e=Q.translate(t/2,y/2).scale(.8);E.call(o.transform,e)}return()=>{l&&a.current&&a.current.removeEventListener("touchstart",c)}},[R,p,B,g,_]);const z=()=>{if(!m||!h.current)return{};const t=h.current.getBoundingClientRect(),y=m.position.x<_.width/2;N(m.depth);let E=y?-250:50,C=m.position.x+E;const o=250,c=120;C<0&&(C=10),C+o>t.width&&(C=t.width-o-10);let l=m.position.y-c/2;return l<0&&(l=10),l+c>t.height&&(l=t.height-c-10),{position:"absolute",left:`${C}px`,top:`${l}px`,zIndex:1e3}};return i.jsxs("div",{className:"mind-map-wrapper",ref:h,children:[i.jsx("svg",{ref:a}),m&&i.jsxs("div",{className:"edit-node-panel",style:z(),children:[i.jsx("input",{type:"text",value:m.text,onChange:t=>P({...m,text:t.target.value}),onKeyPress:t=>t.key==="Enter"&&I(),autoFocus:!0}),i.jsxs("div",{className:"edit-node-buttons buttons-row",children:[i.jsx("button",{onClick:I,className:"save-button",children:"Сохранить"}),i.jsx("button",{onClick:k,className:"add-button",children:"+"}),m.depth!==0&&i.jsx("button",{onClick:G,className:"delete-button",children:"×"}),i.jsx("button",{onClick:()=>P(null),className:"cancel-button",children:"Отмена"})]})]})]})},at={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},Et=()=>{const[R,p]=j.useState(()=>{const w=localStorage.getItem("mindMapData");return w?JSON.parse(w):at}),[B,g]=j.useState(!1),d=j.useRef(null),a=j.useRef(null),h=j.useRef(null);j.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify(R))},[R]),j.useEffect(()=>{const w=A=>{d.current&&a.current&&!d.current.contains(A.target)&&!a.current.contains(A.target)&&g(!1)};return document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[]);const m=w=>{console.log("Выбран узел:",w)},P=w=>{const A=N=>N.id===w.id?w:{...N,children:N.children.map(A)};p(N=>({root:A(N.root)}))},nt=(w,A)=>{const N=k=>k.id===A?{...k,children:k.children.filter(G=>G.id!==w)}:{...k,children:k.children.map(N)};p(k=>({root:N(k.root)}))},J=()=>{const w={root:{id:R.root.id,text:at.root.text,children:[]}};p(w)},_=()=>{const w=JSON.stringify(R,null,2),A="data:application/json;charset=utf-8,"+encodeURIComponent(w),N="mindmap.json",k=document.createElement("a");k.setAttribute("href",A),k.setAttribute("download",N),k.click(),g(!1)},V=async()=>{h.current&&await h.current.exportAsPDF(),g(!1)},Y=async()=>{h.current&&await h.current.exportAsPNG(),g(!1)},K=async()=>{h.current&&await h.current.exportAsJPEG(),g(!1)},U=w=>{var N;const A=(N=w.target.files)==null?void 0:N[0];if(A){const k=new FileReader;k.onload=G=>{var I;try{const z=JSON.parse((I=G.target)==null?void 0:I.result);p(z)}catch(z){console.error("Ошибка при импорте файла:",z),alert("Ошибка при импорте файла. Проверьте формат файла.")}},k.readAsText(A)}},Z=()=>{g(!B)};return i.jsxs("div",{className:"app",children:[i.jsx("a",{href:"https://github.com/lelkaklel/mindmapr",className:"github-corner","aria-label":"Просмотреть исходный код на GitHub",children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",bottom:0,border:0,right:0,transform:"scale(1, -1)"},"aria-hidden":"true",children:[i.jsx("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),i.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),i.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})}),i.jsxs("header",{className:"app-header",children:[i.jsxs("h1",{children:["MindMapr ",i.jsx("span",{children:"- Редактор диаграмм связей"})]}),i.jsxs("div",{className:"app-controls",children:[i.jsxs("div",{className:"export-menu-container",children:[i.jsx("button",{onClick:Z,ref:a,className:"export-button",children:"Экспорт"}),B&&i.jsxs("div",{className:"export-menu",ref:d,children:[i.jsx("button",{onClick:_,children:"JSON"}),i.jsx("button",{onClick:V,children:"PDF"}),i.jsx("button",{onClick:Y,children:"PNG"}),i.jsx("button",{onClick:K,children:"JPEG"})]})]}),i.jsxs("label",{className:"import-button",children:["Импорт",i.jsx("input",{type:"file",accept:".json",onChange:U,style:{display:"none"}})]}),i.jsx("button",{onClick:J,className:"reset-button",children:"Очистить"})]})]}),i.jsx("main",{className:"app-main",children:i.jsx("div",{className:"mind-map-container",children:i.jsx(bt,{data:R,onNodeClick:m,onNodeUpdate:P,onNodeDelete:nt,exportRef:h})})})]})};et.createRoot(document.getElementById("root")).render(i.jsx(ut.StrictMode,{children:i.jsx(Et,{})}));
