import{r as j,a as lt,R as dt}from"./react-DJ1oPbzn.js";import{t as W,s as O,z as ht,i as K,h as ut,a as F}from"./d3-CSd-2QcB.js";import{h as Q,F as nt,E as ft}from"./vendor-B5CLxLTD.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))x(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&x(u)}).observe(document,{childList:!0,subtree:!0});function B(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function x(h){if(h.ep)return;h.ep=!0;const a=B(h);fetch(h.href,a)}})();var at={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pt=j,gt=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),xt=Object.prototype.hasOwnProperty,yt=pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wt={key:!0,ref:!0,__self:!0,__source:!0};function ct(R,m,B){var x,h={},a=null,u=null;B!==void 0&&(a=""+B),m.key!==void 0&&(a=""+m.key),m.ref!==void 0&&(u=m.ref);for(x in m)xt.call(m,x)&&!wt.hasOwnProperty(x)&&(h[x]=m[x]);if(R&&R.defaultProps)for(x in m=R.defaultProps,m)h[x]===void 0&&(h[x]=m[x]);return{$$typeof:gt,type:R,key:a,ref:u,props:h,_owner:yt.current}}X.Fragment=mt;X.jsx=ct;X.jsxs=ct;at.exports=X;var i=at.exports,tt={},rt=lt;tt.createRoot=rt.createRoot,tt.hydrateRoot=rt.hydrateRoot;const H=200,ot=80,st={0:{fill:"#ff9800",stroke:"#e65100",textColor:"#fff",fontSize:16,fontWeight:"bold",padding:15,height:40,strokeWidth:3},1:{fill:"#2196F3",stroke:"#0D47A1",textColor:"#fff",fontSize:14,fontWeight:"bold",padding:10,height:35,strokeWidth:2.5},2:{fill:"#4CAF50",stroke:"#1B5E20",textColor:"#fff",fontSize:13,fontWeight:600,padding:8,height:30,strokeWidth:2},default:{fill:"#f0f0f0",stroke:"#999",textColor:"#333",fontSize:12,fontWeight:"normal",padding:6,height:28,strokeWidth:1.5}},Ct=({data:R,onNodeClick:m,onNodeUpdate:B,onNodeDelete:x,exportRef:h})=>{const a=j.useRef(null),u=j.useRef(null),[y,D]=j.useState(null),[et,J]=j.useState(1),[_,V]=j.useState({width:0,height:0}),Y=()=>{if(u.current){const{width:e,height:f}=u.current.getBoundingClientRect();V({width:e,height:f})}},U=async()=>{if(!(!a.current||!u.current)){D(null),await new Promise(e=>setTimeout(e,100));try{const e=O(a.current),f=e.select("g"),$=W(e.node()),d=u.current.getBoundingClientRect(),o=d.width,s=d.height,c=document.createElement("div");document.body.appendChild(c),c.style.position="absolute",c.style.left="-9999px",c.style.width="1200px",c.style.height="842px";const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width","1200"),l.setAttribute("height","842"),l.setAttribute("viewBox","0 0 1200 842");const E=document.createElementNS("http://www.w3.org/2000/svg","g"),g=f.node();if(g){Array.from(g.childNodes).forEach(T=>{E.appendChild(T.cloneNode(!0))});const r=40,t=g.getBBox(),n=(1200-r*2)/t.width,p=(842-r*2)/t.height,C=Math.min(n,p,2),A=1200/2,N=842/2,L=`translate(${A}, ${N}) scale(${C}) translate(${-t.x-t.width/2}, ${-t.y-t.height/2})`;E.setAttribute("transform",L),l.appendChild(E),c.appendChild(l)}const w=await Q(c,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(c);const M=new ft({orientation:"landscape",unit:"mm",format:"a4"}),P=w.toDataURL("image/jpeg",1);M.addImage(P,"JPEG",0,0,297,210),M.save("mind_map.pdf")}catch(e){console.error("Ошибка при экспорте в PDF:",e)}}},Z=async()=>{if(!(!a.current||!u.current)){D(null),await new Promise(e=>setTimeout(e,100));try{const e=O(a.current),f=e.select("g"),$=W(e.node()),d=u.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=f.node();if(l){Array.from(l.childNodes).forEach(C=>{c.appendChild(C.cloneNode(!0))});const g=50,w=l.getBBox(),M=(1500-g*2)/w.width,P=(1e3-g*2)/w.height,r=Math.min(M,P,2),t=1500/2,n=1e3/2,p=`translate(${t}, ${n}) scale(${r}) translate(${-w.x-w.width/2}, ${-w.y-w.height/2})`;c.setAttribute("transform",p),s.appendChild(c),o.appendChild(s)}const E=await Q(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),E.toBlob(g=>{g&&nt.saveAs(g,"mind_map.png")},"image/png")}catch(e){console.error("Ошибка при экспорте в PNG:",e)}}},q=async()=>{if(!(!a.current||!u.current)){D(null),await new Promise(e=>setTimeout(e,100));try{const e=O(a.current),f=e.select("g"),$=W(e.node()),d=u.current.getBoundingClientRect(),o=document.createElement("div");document.body.appendChild(o),o.style.position="absolute",o.style.left="-9999px",o.style.width="1500px",o.style.height="1000px";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","1500"),s.setAttribute("height","1000"),s.setAttribute("viewBox","0 0 1500 1000");const c=document.createElementNS("http://www.w3.org/2000/svg","g"),l=f.node();if(l){Array.from(l.childNodes).forEach(C=>{c.appendChild(C.cloneNode(!0))});const g=50,w=l.getBBox(),M=(1500-g*2)/w.width,P=(1e3-g*2)/w.height,r=Math.min(M,P,2),t=1500/2,n=1e3/2,p=`translate(${t}, ${n}) scale(${r}) translate(${-w.x-w.width/2}, ${-w.y-w.height/2})`;c.setAttribute("transform",p),s.appendChild(c),o.appendChild(s)}const E=await Q(o,{scale:2,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(o),E.toBlob(g=>{g&&nt.saveAs(g,"mind_map.jpg")},"image/jpeg",.9)}catch(e){console.error("Ошибка при экспорте в JPEG:",e)}}};j.useEffect(()=>{h&&(h.current={exportAsPDF:U,exportAsPNG:Z,exportAsJPEG:q})},[h]),j.useEffect(()=>(Y(),window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)),[]);const v=(e,f,$)=>{const d=f/2,o=$/2,s=l=>!l.children||l.children.length===0?ot:Math.max(ot,F(l.children,E=>s(E))),c=(l,E,g,w=!1,M=$,P=o,r=0)=>{if(l.y=E,l.x=g,!l.children||l.children.length===0)return;const t=[...l.children].sort((C,A)=>{const N=s(C);return s(A)-N}),n=F(t,C=>s(C));let p=g-n/2;t.forEach(C=>{const A=s(C),N=p+A/2,L=w?E-H:E+H;c(C,L,N,w,A,g,r+1),p+=A})};if(e.x=o,e.y=d,e.children&&e.children.length>0){const l=Math.ceil(e.children.length/2);e.children.length-l;const E=e.children.slice(0,l),g=e.children.slice(l),w=F(E,t=>s(t)),M=F(g,t=>s(t));let P=o-w/2;E.forEach(t=>{const n=s(t),p=P+n/2;c(t,d-H,p,!0,n,o,1),P+=n});let r=o-M/2;g.forEach(t=>{const n=s(t),p=r+n/2;c(t,d+H,p,!1,n,o,1),r+=n})}return e},S=(e,f=14)=>e.length*f*.6+10,b=e=>st[e.toString()]||st.default,k=()=>{if(!y)return;const e={id:Date.now().toString(),text:"Новый узел",children:[]};y.node.children.push(e),B&&B(y.node),D(null)},z=()=>{!y||y.depth===0||!y.parentId||x&&(x(y.node.id,y.parentId),D(null))},G=()=>{if(!y||!B)return;const e={...y.node,text:y.text};if(a.current){const f=O(a.current).select(`g.node[data-id="${e.id}"]`);if(!f.empty()){f.select("text").text(e.text);const $=b(y.depth),d=S(e.text,$.fontSize)+$.padding*2;f.select("rect").attr("x",-d/2).attr("width",d)}}B(e),D(null)};j.useEffect(()=>{if(!a.current||!u.current||!R)return;const{width:e,height:f}=_;let $=null;if(a.current)try{$=W(a.current)}catch(r){console.log("Ошибка при получении трансформации:",r)}const d=O(a.current).attr("width",e).attr("height",f);d.selectAll("*").remove();const o=d.append("g"),s=ht().scaleExtent([.1,3]).on("zoom",r=>{o.attr("transform",r.transform),J(r.transform.k)});d.call(s);const c=d.append("g").attr("class","zoom-controls").attr("transform",`translate(${e-35}, 20)`);c.append("circle").attr("r",15).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{d.transition().duration(300).call(s.scaleBy,1.2)}),c.append("text").attr("x",0).attr("y",5).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("+"),c.append("circle").attr("r",15).attr("cy",40).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{d.transition().duration(300).call(s.scaleBy,.8)}),c.append("text").attr("x",0).attr("y",45).attr("text-anchor","middle").attr("font-size","20px").style("pointer-events","none").text("−"),c.append("circle").attr("r",15).attr("cy",80).attr("fill","#fff").attr("stroke","#ccc").attr("cursor","pointer").on("click",()=>{const r=o.node();if(r){const t=r.getBBox(),n=40,p=(e-n*2)/t.width,C=(f-n*2)/t.height,A=Math.min(p,C,.8),N=e/2,L=f/2,T=K.translate(N,L).scale(A).translate(-t.x-t.width/2,-t.y-t.height/2);d.call(s.transform,T)}}),c.append("text").attr("x",0).attr("y",85).attr("text-anchor","middle").attr("font-size","18px").style("pointer-events","none").text("⛶");const l=ut(R.root);v(l,e,f);const E=o.append("g").attr("class","links-layer"),g=o.append("g").attr("class","nodes-layer"),w=(r,t)=>{const n=t?r.source:r.target,p=b(n.depth),C=n.y<e/2,N=(S(n.data.text,p.fontSize)+p.padding*2)/2;return p.height/2,t?r.target.y<n.y?{x:n.y-N,y:n.x}:{x:n.y+N,y:n.x}:C?{x:n.y+N,y:n.x}:{x:n.y-N,y:n.x}},M=r=>{const t=w(r,!0),n=w(r,!1);return`M${t.x},${t.y} Q${(t.x+n.x)/2},${t.y} ${(t.x+n.x)/2},${(t.y+n.y)/2} Q${(t.x+n.x)/2},${n.y} ${n.x},${n.y}`};E.selectAll(".link").data(l.links()).enter().append("path").attr("class","link").attr("d",r=>M(r)).style("fill","none").style("stroke",r=>r.target.depth===1?"#666":"#999").style("stroke-width",r=>{const t=r.target.depth;return Math.max(1,6-t*1.5)+"px"});const P=g.selectAll(".node").data(l.descendants()).enter().append("g").attr("class","node").attr("transform",r=>`translate(${r.y},${r.x})`);if(P.each(function(r){const t=O(this),n=b(r.depth);r.y<e/2;const p=S(r.data.text,n.fontSize)+n.padding*2,C=n.height;t.append("rect").attr("x",-p/2).attr("y",-C/2).attr("width",p).attr("height",C).attr("rx",5).attr("ry",5).style("fill",n.fill).style("stroke",n.stroke).style("stroke-width",n.strokeWidth),t.append("text").attr("dy",".35em").attr("text-anchor","middle").style("font-size",`${n.fontSize}px`).style("font-weight",n.fontWeight).style("fill",n.textColor).text(r.data.text)}),P.on("click",(r,t)=>{var N;r.stopPropagation(),(N=u.current)==null||N.getBoundingClientRect();const n=W(d.node()),p=t.y*n.k+n.x,C=t.x*n.k+n.y;let A;t.parent&&(A=t.parent.data.id),D({node:t.data,text:t.data.text,position:{x:p,y:C},parentId:A,depth:t.depth}),m&&m(t.data)}),d.on("click",()=>{D(null)}),P.attr("data-id",r=>r.data.id),$)d.call(s.transform,$);else{const r=o.node();if(r){const t=r.getBBox(),n=40,p=(e-n*2)/t.width,C=(f-n*2)/t.height,A=Math.min(p,C,.8),N=e/2,L=f/2,T=K.translate(N,L).scale(A).translate(-t.x-t.width/2,-t.y-t.height/2);d.call(s.transform,T)}else{const t=K.translate(e/2,f/2).scale(.8);d.call(s.transform,t)}}},[R,m,B,x,_]);const I=()=>{if(!y||!u.current)return{};const e=u.current.getBoundingClientRect(),f=y.position.x<_.width/2;b(y.depth);let $=f?-250:50,d=y.position.x+$;const o=250,s=120;d<0&&(d=10),d+o>e.width&&(d=e.width-o-10);let c=y.position.y-s/2;return c<0&&(c=10),c+s>e.height&&(c=e.height-s-10),{position:"absolute",left:`${d}px`,top:`${c}px`,zIndex:1e3}};return i.jsxs("div",{className:"mind-map-wrapper",ref:u,children:[i.jsx("svg",{ref:a}),y&&i.jsxs("div",{className:"edit-node-panel",style:I(),children:[i.jsx("input",{type:"text",value:y.text,onChange:e=>D({...y,text:e.target.value}),onKeyPress:e=>e.key==="Enter"&&G(),autoFocus:!0}),i.jsxs("div",{className:"edit-node-buttons buttons-row",children:[i.jsx("button",{onClick:G,className:"save-button",children:"Сохранить"}),i.jsx("button",{onClick:k,className:"add-button",children:"+"}),y.depth!==0&&i.jsx("button",{onClick:z,className:"delete-button",children:"×"}),i.jsx("button",{onClick:()=>D(null),className:"cancel-button",children:"Отмена"})]})]})]})},it={root:{id:"1",text:"Главная идея",children:[{id:"2",text:"Подтема 1",children:[]},{id:"3",text:"Подтема 2",children:[]}]}},vt=()=>{const[R,m]=j.useState(()=>{const v=localStorage.getItem("mindMapData");return v?JSON.parse(v):it}),[B,x]=j.useState(!1),h=j.useRef(null),a=j.useRef(null),u=j.useRef(null);j.useEffect(()=>{localStorage.setItem("mindMapData",JSON.stringify(R))},[R]),j.useEffect(()=>{const v=S=>{h.current&&a.current&&!h.current.contains(S.target)&&!a.current.contains(S.target)&&x(!1)};return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[]);const y=v=>{console.log("Выбран узел:",v)},D=v=>{const S=b=>b.id===v.id?v:{...b,children:b.children.map(S)};m(b=>({root:S(b.root)}))},et=(v,S)=>{const b=k=>k.id===S?{...k,children:k.children.filter(z=>z.id!==v)}:{...k,children:k.children.map(b)};m(k=>({root:b(k.root)}))},J=()=>{const v={root:{id:R.root.id,text:it.root.text,children:[]}};m(v)},_=()=>{const v=JSON.stringify(R,null,2),S="data:application/json;charset=utf-8,"+encodeURIComponent(v),b="mindmap.json",k=document.createElement("a");k.setAttribute("href",S),k.setAttribute("download",b),k.click(),x(!1)},V=async()=>{u.current&&await u.current.exportAsPDF(),x(!1)},Y=async()=>{u.current&&await u.current.exportAsPNG(),x(!1)},U=async()=>{u.current&&await u.current.exportAsJPEG(),x(!1)},Z=v=>{var b;const S=(b=v.target.files)==null?void 0:b[0];if(S){const k=new FileReader;k.onload=z=>{var G;try{const I=JSON.parse((G=z.target)==null?void 0:G.result);m(I)}catch(I){console.error("Ошибка при импорте файла:",I),alert("Ошибка при импорте файла. Проверьте формат файла.")}},k.readAsText(S)}},q=()=>{x(!B)};return i.jsxs("div",{className:"app",children:[i.jsx("a",{href:"https://github.com/lelkaklel/mindmapr",className:"github-corner","aria-label":"Просмотреть исходный код на GitHub",children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",bottom:0,border:0,right:0,transform:"scale(1, -1)"},"aria-hidden":"true",children:[i.jsx("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),i.jsx("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),i.jsx("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]})}),i.jsxs("header",{className:"app-header",children:[i.jsx("h1",{children:i.jsx("span",{children:"MindMapr"})}),i.jsxs("div",{className:"app-controls",children:[i.jsxs("div",{className:"export-menu-container",children:[i.jsx("button",{onClick:q,ref:a,className:"export-button",children:"Экспорт"}),B&&i.jsxs("div",{className:"export-menu",ref:h,children:[i.jsx("button",{onClick:_,children:"JSON"}),i.jsx("button",{onClick:V,children:"PDF"}),i.jsx("button",{onClick:Y,children:"PNG"}),i.jsx("button",{onClick:U,children:"JPEG"})]})]}),i.jsxs("label",{className:"import-button",children:["Импорт",i.jsx("input",{type:"file",accept:".json",onChange:Z,style:{display:"none"}})]}),i.jsx("button",{onClick:J,className:"reset-button",children:"Очистить"})]})]}),i.jsx("main",{className:"app-main",children:i.jsx("div",{className:"mind-map-container",children:i.jsx(Ct,{data:R,onNodeClick:y,onNodeUpdate:D,onNodeDelete:et,exportRef:u})})})]})};tt.createRoot(document.getElementById("root")).render(i.jsx(dt.StrictMode,{children:i.jsx(vt,{})}));
